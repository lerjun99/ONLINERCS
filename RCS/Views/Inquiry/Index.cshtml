@using System.Globalization;
@model RCS.ApplicationEntityModels.EntityModels.ORStatusModel;
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string message = "";
    if (ViewData["Message"] != null)
    {
        message = ViewData["Message"].ToString();
    }
}
<style>
    .plaintext
    {
        font-weight:100;
        color:black;
    }

    .boldtext {
        font-weight:bold;
        color:black;
    }
    .btn-pay {
        width: 100% !important;
        color: var(--white) !important;
        transition: all 0.5s ease-in-out !important;
        padding: 10px 65px !important;
        border-radius: 15px !important;
        position: relative !important;
        border-radius: 99px !important;
        background-color: #003f88;
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        justify-content: center !important;
        box-sizing: border-box !important;
    }
    .fa-print:hover {
        color: var(--dark);
        transform: scale(1.5);
    }
    table.dataTable.no-footer {
        border: 2px solid #d3c8c8 !important;
        border-radius: 15px !important;

    }
    td{
        font-weight:bolder;
        text-align:center;
    }

    td .a{
        font-weight: bolder;
        text-align: center;
    }
    .dataTables_wrapper .dataTables_length {
        height: 70px;
    }
    .radio-group
    {
        display:flex;
        width:100%;
    }
    .radio-group label {
        display: inline-block;
        margin-top:15px;
        width:100%;
    }

    .radio-group input[type="radio"] {
        display: inline-block;
        margin-right: 10px; /* Adjust spacing as needed */
        vertical-align: middle;
        width: 20px;
        height: 20px;
    }

        .radio-group input[type="radio"] + label {
            vertical-align: middle;
        }

        .radio-group input[type="radio"]:checked + label {
            color: blue; /* Change color for checked option */
        }
        .btn-search
        {
            background-color: var(--dark);
            color: white;
            border-radius: 50px;
            padding: 5px;
            width: 150px;
            cursor:pointer;
        } 
        .btn-export
        {
            background-color: var(--dark);
            color: white;
            border-radius: 50px;
            padding: 15px;
            width: 250px;
            cursor:pointer;
        }

    a.disabled {
        background-color: var(--dark);
        color: white;
        border-radius: 50px;
        padding: 15px;
        cursor: pointer;
        pointer-events: none;
        opacity: 0.5; /* Optional: Make the link semi-transparent */
        /* text-decoration: line-through; /* Optional: Add a strikethrough */ */
    }

    a.enabled {
        background-color: var(--dark);
        color: white;
        border-radius: 50px;
        padding: 15px;
        cursor: pointer;
       
    }

    #export-result:hover {
        background-color: #007bff; /* Example hover color */
        cursor: pointer; /* Change cursor to pointer on hover */
    }
    a:hover {
        text-decoration: none;
    }
    .btn-search:hover{
        background-color: #007bff;
        color: white;
        border-radius: 50px;
        padding: 5px;
        width: 150px;
        cursor: pointer;

    }
</style>
<div id="dashboard-main-container">
        <div class="title-main-container-inquiry">
            <div class="content-container">
                <span class="text-title">Inquiry</span>

            </div>
        </div>

        <div class="top-main-container ">

        </div>
    <div class="main-container-inquiry">
        <div class="content-filter" style="margin-left: 15px;">
            <div class="sub-content">
                <div class="mod-form">
                    <span class="text-search">Search Criteria</span>
                    <div class="input-container">
                    
                    </div>
                </div>
                <div class="mod-form-2">
                </div>
            </div>
        </div>
        <div class="content-filter">
            <div class="inq-content-fees">
                <div class="mod-form">
                    <span class="text-left">LTO Issuing Site</span>
                    @* <select id="issuesite" style="width: 100%;margin-top:10px" disabled>
                        <option value="0" selected>DO0104</option>
                    </select> *@
                    <input type="text" value="DO0104" id="issueid" class="mod-inputs" placeholder="" style="text-align:left !important" disabled/>
                </div>
                <div class="mod-form">
                    <span class="text-left">OR No.</span>
                    <div class="input-container">
                        <input type="text" value="" id="ornum" class="mod-inputs" placeholder="" style="text-align:left !important" />
                    </div>
                </div>
               
            </div>
        </div>
        <div class="content-filter">
            <div class="inq-content-fees">
                <div class="mod-form">
                    <span class="text-left">OR Date From</span>
                    <input type="date" value="" id="datefrom" class="mod-inputs-nw" placeholder="Date" style="width: 100%;margin-top:10px" />

                </div>
                <div class="mod-form">
                    <span class="text-left">OR Date To</span>
                    <input type="date" value="" id="dateto" class="mod-inputs-nw" placeholder="Date" style="width: 100%;margin-top:10px" />

                </div>
                <div class="mod-form">
                    <span class="text-left">Status</span>
                    <select id="issuesite" style="width: 100%;margin-top:10px">
                         
                        <option value="0" selected disabled>Select OR Status</option>
                  
                        @foreach (var site in Model.Statuslist)
                        {
                            <option value="@site.CODE">@site.DESCRIPTION</option> <!-- Customize based on your model properties -->
                        }
                    </select>
                </div>
            </div>
        </div>
        <div class="content-filter">
            <div class="inq-content-fees">
                <div class="mod-form-radio">
                    <span class="text-left">Customer Type</span>
                    <div class="radio-group">
                        <label for="individual">
                            <input type="radio" id="individual" name="customerType" value="individual" checked>
                            Individual
                        </label>
                        <label for="organization">
                            <input type="radio" id="organization" name="customerType" value="organization">
                            Organization
                        </label>
                    </div>
                </div>
                <div class="mod-form-name" > 
                    <span class="text-left">Last Name</span>
                    <input type="text" value="" id="lname" class="mod-inputs" placeholder=""  />
                </div>
                <div class="mod-form-name">
                    <span class="text-left">First Name</span>
                    <input type="text" value="" id="fname" class="mod-inputs" placeholder=""  />
                </div>
                <div class="mod-form-name">
                    <span class="text-left">Middle Name</span>
                    <input type="text" value="" id="mname" class="mod-inputs" placeholder=""  />
                </div>
                <div class="mod-form-org" style="display:none">
                    <span class="text-left">Organization Name</span>
                    <input type="text" value="" style="text-align:left !important" id="orgname" class="mod-inputs" placeholder="" />
                </div>
                 <div class="mod-form-btn-1">
                  @*   <input type="submit" value="PAY" id="btn-search" class="btn-search" name="action" /><i class="fa-solid fa-magnifying-glass"></i> *@
                    <a style="display: flex;align-items: center;gap: 8px;justify-content: center;" class="btn-search" onclick="searchitems()">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <span style="color: white;">Search</span>
                    </a>
                </div>

                
            </div>
        </div>
        <hr />
        <div class="content-filter-table">
            <table id="myTable" class="table table-bordered table-hover w-100">
                <thead>
                </thead>
                <tbody>
                </tbody>

            </table>
            <div id="table-footer">
            </div>

        </div>
        <div class="tbl-btn-container">
            <div class="btn-footer-container-inq">
                <div class="btn-container" style="gap:10px">
                    <a style="display: flex;align-items: center;gap: 8px;justify-content: center;" id="export-result" class="disabled" onclick="prinresult()">
         
                        <i class="fa-solid fa-print" style="font-size: 25px;"></i>
                        <span style="color: white;">PRINT RESULT</span>
                    </a>
                </div>

            </div>
        </div>

    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            const mvnum = "";
            const transcode = "";
            const date = "";
            const customername = "";
            const ornum = "";
            const status = "";
            var tableId = '#myTable';
            if ($.fn.DataTable.isDataTable(tableId)) {
                $(tableId).DataTable().clear().destroy();
            }
           
            datevalidation();
            $("#ornum").on("input", function () {
                const inputValue = $(this).val();
               if (inputValue.length > 1) {
                    console.log("Input contains text (multiple characters).");
                   disabledall();
                    $('#datefrom').val('');
                    $('#dateto').val('');
                 
                   
                } 
            });
            $("#lname").on("input", function () {
                const inputValue = $(this).val();
                if (inputValue.length > 1) {
                    console.log("Input contains text (multiple characters).");
                    document.getElementById("issuesite").disabled = true;
                    document.getElementById("datefrom").disabled = true;
                    document.getElementById("dateto").disabled = true;
                    document.getElementById("ornum").disabled = true;
                    $('#datefrom').val('');
                    $('#dateto').val('');
                    $('#orgname').val('');
                    $('#ornum').val('');
                    $('#issuesite').val('0');



                }
            });
            $("#fname").on("input", function () {
                const inputValue = $(this).val();
                if (inputValue.length > 1) {
                    console.log("Input contains text (multiple characters).");
                    document.getElementById("issuesite").disabled = true;
                    document.getElementById("datefrom").disabled = true;
                    document.getElementById("dateto").disabled = true;
                    document.getElementById("ornum").disabled = true;
                    $('#datefrom').val('');
                    $('#dateto').val('');
                    $('#orgname').val('');
                    $('#ornum').val('');
                    $('#issuesite').val('0');



                }
            });
            $("#mname").on("input", function () {
                const inputValue = $(this).val();
                if (inputValue.length > 1) {
                    console.log("Input contains text (multiple characters).");
                    document.getElementById("issuesite").disabled = true;
                    document.getElementById("datefrom").disabled = true;
                    document.getElementById("dateto").disabled = true;
                    document.getElementById("ornum").disabled = true;
                    $('#datefrom').val('');
                    $('#dateto').val('');
                    $('#orgname').val('');
                    $('#ornum').val('');
                    $('#issuesite').val('0');



                }
            });
            $("#issuesite").on("change", function () {
                // const today = new Date();
                // const year = today.getFullYear();
                // const month = ("0" + (today.getMonth() + 1)).slice(-2); // Add leading zero if needed
                // const day = ("0" + today.getDate()).slice(-2); // Add leading zero if needed
                // const formattedDate = year + "-" + month + "-" + day;
                // $('#datefrom').val(formattedDate);
                // $('#dateto').val(formattedDate);
                console.log('Select element has been changed!');
                document.getElementById("ornum").disabled = true;
                document.getElementById("fname").disabled = true;
                document.getElementById("lname").disabled = true;
                document.getElementById("mname").disabled = true;
                document.querySelector('input[name="customerType"][value="individual"]').disabled = true;
                document.querySelector('input[name="customerType"][value="organization"]').disabled = true;
                $('#ornum').val('');
                $('#fname').val('');
                $('#lname').val('');
                $('#mname').val('');
                $('#orgname').val('');
            });
           
        })
        const option1 = document.getElementById('individual');
        const option2 = document.getElementById('organization');
        const modname = document.querySelectorAll('.mod-form-name');
        const modorg = document.querySelectorAll('.mod-form-org');
        const modradio = document.querySelectorAll('.mod-form-radio');

        option1.addEventListener('change', function () {
            if (this.checked) {
            
                document.getElementById("issuesite").disabled = true;
                document.getElementById("ornum").disabled = true;
                document.getElementById("datefrom").disabled = true;
                document.getElementById("dateto").disabled = true;
                $('#orgname').val('');
                $('#ornum').val('');
                $('#issuesite').val('0');
                modname.forEach(element => {
                    element.style.display = 'block';
                });
                modorg.forEach(element => {
                    element.style.display = 'none';
                });
                modradio.forEach(content => {
                    content.style.setProperty("width", "100%", "important");
                    content.style.setProperty("display", "flex", "important");
                    content.style.setProperty("flex-direction", "column", "important");
                    content.style.setProperty("margin", "15px", "important");
                });
            }
        });

        option2.addEventListener('change', function () {
            if (this.checked) {
                modname.forEach(element => {
                    element.style.display = 'none';
                });
                document.getElementById("issuesite").disabled = true;
                document.getElementById("ornum").disabled = true;
                document.getElementById("datefrom").disabled = true;
                document.getElementById("dateto").disabled = true;
                $('#ornum').val('');
                $('#issuesite').val('0');
                $('#fname').val('');
                $('#lname').val('');
                $('#mname').val('');
                modradio.forEach(content => {
                    content.style.setProperty("width", "500px", "important");
                    content.style.setProperty("display", "flex", "important");
                    content.style.setProperty("flex-direction", "column", "important");
                    content.style.setProperty("margin", "15px", "important");
                });
                modorg.forEach(element => {
                    element.style.display = 'block';
                });
            }
        });
        function initializeDataTable(selectedText) {
            var tableId = '#myTable';
            var lastSelectedRow = null;
            // Check if DataTable is already initialized
            if ($.fn.DataTable.isDataTable(tableId)) {
                // Destroy the existing DataTable instance
                $(tableId).DataTable().clear().destroy();
            }
            var data = {
                datefrom: $('#datefrom').val(),
                dateto: $('#dateto').val(),
                fname: $('#fname').val(),
                lname: $('#lname').val(),
                mname: $('#mname').val(),
                orgname: $('#orgname').val(),
                status: $('#issuesite').val(),
                ornum: $('#ornum').val(),
            };
            console.log(data);
            // DataTable properties
            var dtProperties = {
                ajax: {
                    url: '@Url.Action("getinquiryList", "Inquiry")',
                    type: "POST",
                    data: {
                        filter: data
                    },
                    dataType: "json",
                    processing: true,
                    serverSide: true,
                    complete: function (xhr) {
                        var url = new URL(window.location.href);
                        var _currentPage = url.searchParams.get("page01") == null ? 1 : url.searchParams.get("page01");

                        table.page(_currentPage - 1).draw('page');
                     

                        if (table.data().length > 0) {
                            $('#export-result').attr('class', 'enabled');
                        } else {
                            // The table is empty
                            $('#export-result').attr('class', 'disabled');
                        }
                    },
                    error: function (err) {
                    
                    }
                },
                columns: [
                    { "title": "Status", "data": "oR_STATUS_DESC" },
                    { "title": "Customer Name", "data": "customeR_NAME" },
                    {
                        "title": "OR No",
                        "data": "oR_NO",
                        "render": function (data) {
                            return `<a href="#" style="align-items: center; gap: 8px;" class="nav-item" data-id="${data}" onclick="fees()" >
                                                                    <span>${data}</span>
                                </a>
                                                                   `;
                        }
                    },
                    { "title": "OR Date", "data": "oR_DATE" },
                    { "title": "OR Amount", "data": "oR_AMT" },
                   
                    {
                        "title": "",
                        "data": "oR_NO",
                        "render": function (data) {
                            return `
                                               <button class='tbl-action' data-id="${data}" style="background-color: transparent;outline: none;cursor: pointer; border: none;font-size: 20px;">
                                                       <i class="fa-solid fa-print"></i>
                                                       </button>
                                                   `;
                        }
                    }
                ], 
                 // Sort the second column (index 1) by descending order
                columnDefs: [
                    {

                        targets: [0,1,5],
                        orderable: false// Ensure DataTables recognizes this column as date type
                    }
                ],
                // Disable searching
                searching: false,
                language: {
                    emptyTable: "<span class='plaintext'>No records found. Please conduct a search by filling in any of the following fields:</span><br> <span class= 'boldtext' >OR No., Status (with a maximum OR Date range of 1 Month), or Customer Name </span>"
                }
            };
            var table = $(tableId).DataTable(dtProperties);
            $(tableId + ' tbody').on('click', 'tr', function () {
                var data = table.row(this).data();
                console.log(data);
                // Remove highlight from the previously selected row
                if (lastSelectedRow) {
                    $(lastSelectedRow).removeClass('selected-row');
                }

                // Highlight the currently selected row
                $(this).addClass('selected-row');
                lastSelectedRow = this;

                if (data) {
                    mvnum = data.txN_ID;
                    status = data.oR_STATUS_DESC;
                    transcode = data.txN_CODE;
                    date = data.txN_DATE;
                    customername = data.customeR_NAME;
                    // You can add additional actions here based on the selected row data
                }
            });
            if (selectedText === 'Cancelled') {
                table.column(5).visible(false); // Hide the action column
            } else {
                table.column(5).visible(true);  // Show the action column
            }
           
        }
        $('#myTable').on('click', '.tbl-action', function () {
            var id = $(this).data('id');
            localStorage.setItem('ornum', id);
            loadModal('/Dashboard/PrintOR?ornum=' + id, '#defaultmodal', 'OR PREVIEW', 'xl', false)

        });
        function datevalidation() {
            const today = new Date().toISOString().split('T')[0];

            // Select all input fields of type date
            const dateInputs = document.querySelectorAll('input[type="date"]');

            // Set max attribute for each date input
            dateInputs.forEach(function (input) {
                input.setAttribute('max', today); // Set max to today's date
            });

            // Validate on form submission

        }
        function disabledall()
        {
        
            document.getElementById("issuesite").disabled = true;
            document.getElementById("datefrom").disabled = true;
            document.getElementById("dateto").disabled = true;
            document.getElementById("fname").disabled = true;
            document.getElementById("lname").disabled = true;
            document.getElementById("mname").disabled = true;
            document.querySelector('input[name="customerType"][value="individual"]').disabled = true;
            document.querySelector('input[name="customerType"][value="organization"]').disabled = true;
        }
        function searchitems() {

            document.getElementById("issuesite").disabled = false;
            document.getElementById("datefrom").disabled = false;
            document.getElementById("dateto").disabled = false;
            document.getElementById("fname").disabled = false;
            document.getElementById("ornum").disabled = false;
            document.getElementById("lname").disabled = false;
            document.getElementById("mname").disabled = false;
            document.querySelector('input[name="customerType"][value="individual"]').disabled = false;
            document.querySelector('input[name="customerType"][value="organization"]').disabled = false;
            const mySelect = document.getElementById('issuesite');
            const selectedValue = mySelect.value;
            const selectedText = mySelect.options[mySelect.selectedIndex].text;
            console.log("Selected Value:", selectedValue);
            console.log("Selected Text:", selectedText);
           
            initializeDataTable(selectedText);
        }
        $('#myTable').on('click', '.nav-item', function () {
            var id = $(this).data('id');
            localStorage.setItem('ornum', id);
            localStorage.setItem('status', status);
            localStorage.setItem('indicator', 'inquiry');
            window.location.href = '/Inquiry/FeesPayment?ornum=' + id;
        });
        function prinresult()
        {
                const divToPrint = document.querySelector('.content-filter-table');
                const printWindow = window.open('', '', 'width=800,height=600');

                // Include your stylesheets (you can include multiple)
                $('link[rel=stylesheet]').each(function () {
                    printWindow.document.write(`<link rel="stylesheet" href="${$(this).attr('href')}" media="print">`);
                });

            const tempDiv = document.createElement('div');

            // Create the new div to insert above the table
            const newDiv = document.createElement('div');
            newDiv.style.mmarginBottom = '100px'; // Example background color
            newDiv.style.width = '100%'; // Example padding
            newDiv.style.textAlign = 'center';
            newDiv.innerHTML = '<h2>Inquiry Result</h2>'; // Replace with your desired content


            // Insert the new div above the table
            tempDiv.appendChild(newDiv);
            tempDiv.innerHTML += divToPrint.querySelector('table').outerHTML;

            // Print the table content
            printWindow.document.write(tempDiv.innerHTML);

                // Close the document
                printWindow.document.close();

                // Focus on the new window and print
                printWindow.focus();
                printWindow.print();
           

        }
    </script>
}